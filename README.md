# Stock Portfolio Analyzer

Fetches live market data for a list of stock tickers and generates a formatted Excel workbook with portfolio analysis, P&L tracking, and an AI-powered insights sheet powered by Claude.

## Features

- **Live market data** via [yfinance](https://github.com/ranaroussi/yfinance) — no API key required
- **P&L tracking** — buy date and shares in the tickers file; fetches historical buy price automatically
- **Three Excel sheets:**
  - **Portfolio** — prices, returns (1W → 5Y), P&L, fundamentals (P/E, beta, 52W high/low, dividend yield)
  - **Distribution** — auto-calculated country and sector breakdown via SUMIF formulas
  - **AI Analysis** — structured portfolio insights generated by Claude
- **Conditional formatting** — green/red fills on all return and P&L columns
- **Multi-currency** — supports USD, EUR, DKK, CHF, and any Yahoo Finance currency

## Supported exchanges

Any ticker supported by Yahoo Finance, e.g. `AAPL`, `ASML.AS`, `SAP.DE`, `NESN.SW`, `NOVO-B.CO`.

## Setup

```bash
pip install -r requirements.txt
cp .env.example .env
# Add your Anthropic API key to .env (optional — skipped gracefully if absent)
```

## Usage

```bash
python stock_analyzer.py              # uses tickers.txt
python stock_analyzer.py my_list.txt  # custom tickers file
```

Output: `portfolio_YYYYMMDD_HHMM.xlsx` in the same directory.

## Tickers file format

```
# TICKER[,SHARES[,BUY_DATE]]
AAPL,50,2022-06-15
MSFT,20,2021-11-22
ASML.AS,8,2023-01-16
NOVO-B.CO        # shares and buy date are optional
```

## Excel walkthrough

| Column | Content |
|--------|---------|
| A–D | Ticker, name, current price, currency |
| E–K | Buy date, buy price, **# shares** (yellow — edit here), total value, cost basis, P&L $, P&L % |
| L–U | % returns: 1W, 1M, 3M, 6M, YTD, 1Y, 2Y, 3Y, 4Y, 5Y |
| V–AE | Country, sector, industry, market cap, P/E, 52W high/low, % from 52W high, dividend yield, beta |

Columns H, I, J (total value, cost basis, P&L $) and the Distribution sheet update automatically as you fill in column G (# shares).

## AI Analysis sheet

Requires an `ANTHROPIC_API_KEY` in `.env` with available API credits ([console.anthropic.com](https://console.anthropic.com)).
The sheet is skipped gracefully if the key is absent or invalid.

## Requirements

- Python 3.8+
- See `requirements.txt`
